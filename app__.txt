import * as fs from 'fs';
import 'ag-psd/initialize-canvas'; // only needed for reading image data and thumbnails
import { readPsd, writePsd, writePsdBuffer } from 'ag-psd';





const file = fs.readFileSync('D:/billa/Bureau/footballstatsbotnode/file.psd');

const psd = readPsd(file);



// assuming first layer is the one you want to update and has text already present



psd.children[2].text.text = 'Hello World';

//psd.children[0].text.text = "New text here";
//create a new layer and add text to its source layer AND add it to the psd  
// optionally remove outdated image data
//psd.children[0].canvas = undefined;

// needs `invalidateTextLayers` option to force Photoshop to redraw text layer on load,
// otherwise it will keep the old image data
const outputBuffer = writePsdBuffer(psd, { invalidateTextLayers: true }); 

//fs.writeFileSync('D:/billa/Bureau/footballstatsbotnode/filez.psd', outputBuffer) to save PSD

fs.writeFileSync('D:/billa/Bureau/footballstatsbotnode/filez.png', (psd.canvas as any).toBuffer());